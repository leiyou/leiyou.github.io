<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="网络日志"><title>Greenplum激活standby节点 | Leiyu</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Greenplum激活standby节点</h1><a id="logo" href="/.">Leiyu</a><p class="description">网络日志</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archives</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Greenplum激活standby节点</h1><div class="post-meta">Jan 11, 2017</div><div class="post-content"><p>激活前需确定安装GP时已配置了standby节点，standby作为master的备份节点，当GP集群中master出故障挂了后，可以激活standby节点，激活后的standby成为集群中新的master，可继续管理集群的运行。</p>
<p>测试所有的GP环境有1台master，1台standby，2台segment节点, 主机名：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mdw</span><br><span class="line">smdw</span><br><span class="line">sdw1</span><br><span class="line">sdw2</span><br></pre></td></tr></table></figure></p>
<p>1、查看GP运行时的状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@mdw ~]$ gpstate -a</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">gpstate:mdw:gpadmin-[INFO]:-Greenplum instance status summary</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Master instance                                = Active</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Master standby                                 = smdw</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Standby master state                           = Standby host passive</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total segment instance count from metadata     = 18</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Primary Segment Status</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total primary segments                         = 18</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total primary segment valid (at master)        = 18</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total primary segment failures (at master)     = 0</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid files missing   = 0</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid files found     = 18</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs missing    = 0</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs found      = 18</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number of /tmp lock files missing        = 0</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number of /tmp lock files found          = 18</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number postmaster processes missing      = 0</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Total number postmaster processes found        = 18</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Mirror Segment Status</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-   Mirrors not configured on this array</span><br><span class="line">gpstate:mdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></pre></td></tr></table></figure>
<ul>
<li>输出的信息可看到standby节点已配置且状态是paasive的。*</li>
</ul>
<p>2、standby节点是在master节点出故障的情况下才激活的，因此激活standby节点前先关闭master节点。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@mdw ~]$ gpstop -m</span><br></pre></td></tr></table></figure>
<p>3、进入standby节点主机smdw，激活standby<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@smdw ~]$ gpactivatestandby -d $&#123;MASTER_DATA_DIRECTORY&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:------------------------------------------------------</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Standby data directory    = /data/gpadmin/master/gpseg-1</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Standby port              = 5432</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Standby running           = yes</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Force standby activation  = no</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:------------------------------------------------------</span><br><span class="line">Do you want to continue with standby master activation? Yy|Nn (default=N):</span><br><span class="line"><span class="meta">&gt;</span> y</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-found standby postmaster process</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Updating transaction files filespace flat files...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Updating temporary files filespace flat files...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Promoting standby...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[DEBUG]:-Waiting for connection...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Standby master is promoted</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Reading current configuration...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[DEBUG]:-Connecting to dbname='gpsdb'</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Writing the gp_dbid file - /data/gpadmin/master/gpseg-1/gp_dbid...</span><br><span class="line"></span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-But found an already existing file.</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Hence removed that existing file.</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Creating a new file...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Wrote dbid: 1 to the file.</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Now marking it as read only...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-Verifying the file...</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:------------------------------------------------------</span><br><span class="line">gpactivatestandby:smdw:gpadmin-[INFO]:-The activation of the standby master has completed successfully.</span><br></pre></td></tr></table></figure>
<p>4、standby激活后成为新的master，此时查看GP的状态可看到standby节点未配置状态<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@smdw ~]$ gpstate -a</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">gpstate:smdw:gpadmin-[INFO]:-Greenplum instance status summary</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Master instance                                = Active</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Master standby                                 = No master standby configured</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total segment instance count from metadata     = 18</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Primary Segment Status</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total primary segments                         = 18</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total primary segment valid (at master)        = 18</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total primary segment failures (at master)     = 0</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number of postmaster.pid files missing   = 0</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number of postmaster.pid files found     = 18</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs missing    = 0</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number of postmaster.pid PIDs found      = 18</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number of /tmp lock files missing        = 0</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number of /tmp lock files found          = 18</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number postmaster processes missing      = 0</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Total number postmaster processes found        = 18</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Mirror Segment Status</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-----------------------------------------------------</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-   Mirrors not configured on this array</span><br><span class="line">gpstate:smdw:gpadmin-[INFO]:-----------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>5、此时standby节点已激活，若想要恢复原来的master节点也很简单，只需先将原有的master主机设为standby节点，之后再执行一遍上面的步骤即可.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@smdw ~]$ gpinitstandby -s master  #新建standby</span><br></pre></td></tr></table></figure>
<p>报错：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">smdw:gpadmin-[INFO]:-Validating environment and parameters for standby initialization...</span><br><span class="line">smdw:gpadmin-[INFO]:-Checking for filespace directory /data/gpadmin/master/gpseg-1 on master</span><br><span class="line">smdw:gpadmin-[ERROR]:-Filespace directory already exists on host master</span><br><span class="line">smdw:gpadmin-[ERROR]:-Failed to create standby</span><br><span class="line">smdw:gpadmin-[ERROR]:-Error initializing standby master: master data directory exists</span><br></pre></td></tr></table></figure></p>
<p>移除掉原来master上的 /data/gpadmin/master/gpseg-1目录即可.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">smdw:gpadmin-[INFO]:------------------------------------------------------</span><br><span class="line">smdw:gpadmin-[INFO]:-Greenplum master hostname               = smdw</span><br><span class="line">smdw:gpadmin-[INFO]:-Greenplum master data directory         = /data/gpadmin/master/gpseg-1</span><br><span class="line">smdw:gpadmin-[INFO]:-Greenplum master port                   = 5432</span><br><span class="line">smdw:gpadmin-[INFO]:-Greenplum standby master hostname       = master</span><br><span class="line">smdw:gpadmin-[INFO]:-Greenplum standby master port           = 5432</span><br><span class="line">smdw:gpadmin-[INFO]:-Greenplum standby master data directory = /data/gpadmin/master/gpseg-1</span><br><span class="line">smdw:gpadmin-[INFO]:-Greenplum update system catalog         = On</span><br><span class="line">smdw:gpadmin-[INFO]:------------------------------------------------------</span><br><span class="line">smdw:gpadmin-[INFO]:- Filespace locations</span><br><span class="line">smdw:gpadmin-[INFO]:------------------------------------------------------</span><br><span class="line">smdw:gpadmin-[INFO]:-pg_system -&gt; /data/gpadmin/master/gpseg-1</span><br><span class="line">Do you want to continue with standby master initialization? Yy|Nn (default=N):</span><br><span class="line"><span class="meta">&gt;</span> y</span><br><span class="line">smdw:gpadmin-[INFO]:-Syncing Greenplum Database extensions to standby</span><br><span class="line">smdw:gpadmin-[INFO]:-The packages on master are consistent.</span><br><span class="line">smdw:gpadmin-[INFO]:-Adding standby master to catalog...</span><br><span class="line">smdw:gpadmin-[INFO]:-Database catalog updated successfully.</span><br><span class="line">smdw:gpadmin-[INFO]:-Updating pg_hba.conf file...</span><br><span class="line">smdw:gpadmin-[INFO]:-pg_hba.conf files updated successfully.</span><br><span class="line">smdw:gpadmin-[INFO]:-Updating filespace flat files...</span><br><span class="line">smdw:gpadmin-[INFO]:-Filespace flat file updated successfully.</span><br><span class="line">smdw:gpadmin-[INFO]:-Starting standby master</span><br><span class="line">smdw:gpadmin-[INFO]:-Checking if standby master is running on host: master  in directory: /data/gpadmin/master/gpseg-1</span><br><span class="line">smdw:gpadmin-[INFO]:-Cleaning up pg_hba.conf backup files...</span><br><span class="line">smdw:gpadmin-[INFO]:-Backup files of pg_hba.conf cleaned up successfully.</span><br><span class="line">smdw:gpadmin-[INFO]:-Successfully created standby master on master</span><br></pre></td></tr></table></figure>
<p>6、关闭master节点<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@smdw ~]$ gpstop -m</span><br></pre></td></tr></table></figure></p>
<p>7、 切换到master主机，激活standby<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@mdw ~]$ gpactivatestandby -d $&#123;MASTER_DATA_DIRECTORY&#125;</span><br></pre></td></tr></table></figure></p>
<p>激活成功后，master节点又恢复为原来的主机，为了防止master主机再次挂掉，还是要新建一个standby节点做备用.</p>
<h2 id="standby激活时可能会遇到的问题："><a href="#standby激活时可能会遇到的问题：" class="headerlink" title="standby激活时可能会遇到的问题："></a>standby激活时可能会遇到的问题：</h2><ul>
<li>提示PGPORT未指定<br>这可能是安装GP时.bash_profile 文件里未配置端口.</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@smdw ~]$ cat .bash_profile </span><br><span class="line"><span class="meta">#</span> .bash_profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Get the aliases and functions</span><br><span class="line">if [ -f ~/.bashrc ]; then</span><br><span class="line">        . ~/.bashrc</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> User specific environment and startup programs</span><br><span class="line"></span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line"></span><br><span class="line">source /usr/local/greenplum-db/greenplum_path.sh</span><br><span class="line">export MASTER_DATA_DIRECTORY=/data/gpadmin/master/gpseg-1</span><br><span class="line">export PGPORT=5432  # &lt;&lt;&lt;&lt; 这里</span><br><span class="line">export PGDATABASE=gpsdb</span><br><span class="line"></span><br><span class="line">export PATH</span><br></pre></td></tr></table></figure>
<p><strong> 查看gpinitstandby 的相关命令：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">[gpadmin@smdw ~]$ gpactivatestandby</span><br><span class="line"></span><br><span class="line">A backup, standby master host serves as a 'warm standby' in the </span><br><span class="line">event of the primary master host becoming non-operational. The standby </span><br><span class="line">master is kept up to date by transaction log replication processes (the </span><br><span class="line">walsender and walreceiver), which run on the primary master and standby </span><br><span class="line">master hosts and keep the data between the primary and standby master </span><br><span class="line">hosts synchronized. If the primary master fails, the log replication </span><br><span class="line">process is shut down, and the standby master can be activated in its </span><br><span class="line">place by using the gpactivatestandby utility. Upon activation of the </span><br><span class="line">standby master, the replicated logs are used to reconstruct the state of </span><br><span class="line">the master host at the time of the last successfully committed </span><br><span class="line">transaction. </span><br><span class="line"></span><br><span class="line">The activated standby master effectively becomes the Greenplum Database </span><br><span class="line">master, accepting client connections on the master port and performing </span><br><span class="line">normal master operations such as SQL command processing and workload </span><br><span class="line">management. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*****************************************************</span><br><span class="line">OPTIONS</span><br><span class="line">*****************************************************</span><br><span class="line"></span><br><span class="line">-a (do not prompt) </span><br><span class="line"></span><br><span class="line"> Do not prompt the user for confirmation. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-D (debug) </span><br><span class="line"></span><br><span class="line"> Sets logging level to debug. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-F &lt;list_of_filespaces&gt; </span><br><span class="line"></span><br><span class="line"> A list of filespace names and the associated locations. Each filespace </span><br><span class="line"> name and its location is separated by a colon. If there is more than one </span><br><span class="line"> file space name, each pair (name and location) is separated by a comma. </span><br><span class="line"> For example: </span><br><span class="line"></span><br><span class="line"> filespace1_name:fs1_location,filespace2_name:fs2_location </span><br><span class="line"></span><br><span class="line"> If this option is not specified, gpinitstandby prompts the user for the </span><br><span class="line"> filespace names and locations. </span><br><span class="line"></span><br><span class="line"> If the list is not formatted correctly or number of filespaces do not </span><br><span class="line"> match the number of filespaces already created in the system, </span><br><span class="line"> gpinitstandby returns an error. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-l &lt;logfile_directory&gt; </span><br><span class="line"></span><br><span class="line"> The directory to write the log file. Defaults to ~/gpAdminLogs. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-n (restart standby master) </span><br><span class="line"></span><br><span class="line"> Specify this option to start a Greenplum Database standby master that </span><br><span class="line"> has been configured but has stopped for some reason. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-P &lt;port&gt; </span><br><span class="line"></span><br><span class="line"> This option specifies the port that is used by the Greenplum Database </span><br><span class="line"> standby master. The default is the same port used by the active </span><br><span class="line"> Greenplum Database master. </span><br><span class="line"></span><br><span class="line"> If the Greenplum Database standby master is on the same host as the </span><br><span class="line"> active master, the ports must be different. If the ports are the same </span><br><span class="line"> for the active and standby master and the host is the same, the utility </span><br><span class="line"> returns an error. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-q (no screen output) </span><br><span class="line"></span><br><span class="line"> Run in quiet mode. Command output is not displayed on the screen, but is </span><br><span class="line"> still written to the log file. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-r (remove standby master) </span><br><span class="line"></span><br><span class="line"> Removes the currently configured standby master host from your Greenplum </span><br><span class="line"> Database system. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-s &lt;standby_hostname&gt; </span><br><span class="line"></span><br><span class="line"> The host name of the standby master host. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-v (show utility version) </span><br><span class="line"></span><br><span class="line"> Displays the version, status, last updated date, and check sum of this </span><br><span class="line"> utility. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-? (help) </span><br><span class="line"></span><br><span class="line"> Displays the online help. </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*****************************************************</span><br><span class="line">EXAMPLES</span><br><span class="line">*****************************************************</span><br><span class="line"></span><br><span class="line">Add a standby master host to your Greenplum Database system and start </span><br><span class="line">the synchronization process: </span><br><span class="line"></span><br><span class="line">gpinitstandby -s host09 </span><br><span class="line"></span><br><span class="line">Start an existing standby master host and synchronize the data with the </span><br><span class="line">current primary master host: </span><br><span class="line"></span><br><span class="line">gpinitstandby -n </span><br><span class="line"></span><br><span class="line">NOTE: Do not specify the -n and -s options in the same command.</span><br></pre></td></tr></table></figure>
<h2 id="激活standby节点的相关资料看参考pivotal-gpdb官网"><a href="#激活standby节点的相关资料看参考pivotal-gpdb官网" class="headerlink" title="激活standby节点的相关资料看参考pivotal gpdb官网:"></a>激活standby节点的相关资料看参考pivotal gpdb官网:</h2><p><a href="http://gpdb.docs.pivotal.io/4370/admin_guide/highavail/topics/g-recovering-a-failed-master.html" target="_blank" rel="noopener">Recovering a Failed Master</a></p>
<p><a href="http://gpdb.docs.pivotal.io/4370/admin_guide/highavail/topics/g-enabling-high-availability-features.html" target="_blank" rel="noopener">Enabling High Availability Features</a></p>
<p><strong> 本文中参考的文章有：</strong></p>
<p><a href="http://www.cnblogs.com/lottu/p/5683988.html" target="_blank" rel="noopener">greenplum如何激活，同步,删除standby和恢复原始master
</a></p>
</div><div class="tags"><a href="/tags/Greenplum/">Greenplum</a></div><div class="post-nav"><a class="pre" href="/2017/01/11/mysql忘记root用户密码/">mysql忘记root用户密码</a><a class="next" href="/2016/11/05/Greenplum外部表加载数据/">Greenplum外部表加载数据</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="blog.youlei.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Mongodb/" style="font-size: 15px;">Mongodb</a> <a href="/tags/Greenplum/" style="font-size: 15px;">Greenplum</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/Sass/" style="font-size: 15px;">Sass</a> <a href="/tags/Javascript/" style="font-size: 15px;">Javascript</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Canvas/" style="font-size: 15px;">Canvas</a> <a href="/tags/Data-visual/" style="font-size: 15px;">Data visual</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/R/" style="font-size: 15px;">R</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/ruby/" style="font-size: 15px;">ruby</a> <a href="/tags/D3-js/" style="font-size: 15px;">D3.js</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/01/JavaScript-Array中的原型方法/">JavaScript Array中的原型方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/11/mysql忘记root用户密码/">mysql忘记root用户密码</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/11/Greenplum激活standby节点/">Greenplum激活standby节点</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/05/Greenplum外部表加载数据/">Greenplum外部表加载数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/16/git-多账户使用/">git 多账户使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/11/linux-LVM扩容笔记/">linux LVM扩容笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/GreenPlum客户端认证/">GreenPlum客户端认证</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/26/scope-js-02/">重识javascript中的函数表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/22/R-01/">R笔记（一）Ｒ语言基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/13/sass-01/">Sass学习笔记(一)</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Leiyu.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>